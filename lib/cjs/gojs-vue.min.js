/**
 * gojs-vue
 * v1.0.0
 * by whu-luojian
 */

"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("tslib"),t=require("vue-property-decorator"),a=require("gojs"),n=function(n){function r(){var e=null!==n&&n.apply(this,arguments)||this;return e.modelChangedListener=null,e}return e.__extends(r,n),r.prototype.getDiagram=function(){return this.divEle?a.Diagram.fromDiv(this.divEle):null},r.prototype.updateDiagramClass=function(){var e=this;this.$nextTick((function(){e.getDiagram().requestUpdate()}))},r.prototype.updateNodeDataArray=function(){this.updateDiagram()},r.prototype.updateLinkDataArray=function(){this.updateDiagram()},r.prototype.mounted=function(){var e=this,t=this.initDiagram();t.div=this.divEle,t.delayInitialization((function(){t.model.commit((function(t){t.mergeNodeDataArray(t.cloneDeep(e.nodeDataArray)),e.linkDataArray&&t instanceof a.GraphLinksModel&&t.mergeLinkDataArray(t.cloneDeep(e.linkDataArray)),e.modelData&&t.assignAllDataProperties(t.modelData,e.modelData)}),null)})),this.modelChangedListener=function(t){if(t.isTransactionFinished){var a=t.model.toIncrementalData(t);null!==a&&e.$emit("modelChange",a)}},t.addModelChangedListener(this.modelChangedListener)},r.prototype.beforeDestroy=function(){var e=this.getDiagram();e&&(e.div=null,null!==this.modelChangedListener&&(e.removeModelChangedListener(this.modelChangedListener),this.modelChangedListener=null))},r.prototype.updateDiagram=function(){var e=this.getDiagram();if(e){var t=e.model;null!==this.modelChangedListener&&t.removeChangedListener(this.modelChangedListener),t.startTransaction("update data"),t.mergeNodeDataArray(t.cloneDeep(this.nodeDataArray)),this.linkDataArray&&t instanceof a.GraphLinksModel&&t.mergeLinkDataArray(t.cloneDeep(this.linkDataArray)),this.modelData&&t.assignAllDataProperties(t.modelData,this.modelData),t.commitTransaction("update data"),null!==this.modelChangedListener&&t.addChangedListener(this.modelChangedListener)}},e.__decorate([t.Ref("divRef")],r.prototype,"divEle",void 0),e.__decorate([t.Prop()],r.prototype,"divClassName",void 0),e.__decorate([t.Prop()],r.prototype,"initDiagram",void 0),e.__decorate([t.Prop()],r.prototype,"nodeDataArray",void 0),e.__decorate([t.Prop()],r.prototype,"linkDataArray",void 0),e.__decorate([t.Prop()],r.prototype,"modelData",void 0),e.__decorate([t.Watch("divClassName")],r.prototype,"updateDiagramClass",null),e.__decorate([t.Watch("nodeDataArray",{deep:!0})],r.prototype,"updateNodeDataArray",null),e.__decorate([t.Watch("linkDataArray",{deep:!0})],r.prototype,"updateLinkDataArray",null),r=e.__decorate([t.Component({})],r)}(t.Vue);const r="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());let i;const o={};const d=n;var s=function(){var e=this.$createElement;return(this._self._c||e)("div",{ref:"divRef",staticClass:"gojs-diagram",class:this.divClassName})};s._withStripped=!0;const l=function(e,t,a,n,r,i,o,d,s,l){"boolean"!=typeof o&&(s=d,d=o,o=!1);const m="function"==typeof a?a.options:a;let p;if(e&&e.render&&(m.render=e.render,m.staticRenderFns=e.staticRenderFns,m._compiled=!0,r&&(m.functional=!0)),n&&(m._scopeId=n),i?(p=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,s(e)),e&&e._registeredComponents&&e._registeredComponents.add(i)},m._ssrRegister=p):t&&(p=o?function(e){t.call(this,l(e,this.$root.$options.shadowRoot))}:function(e){t.call(this,d(e))}),p)if(m.functional){const e=m.render;m.render=function(t,a){return p.call(a),e(t,a)}}else{const e=m.beforeCreate;m.beforeCreate=e?[].concat(e,p):[p]}return a}({render:s,staticRenderFns:[]},(function(e){e&&e("data-v-3757022f_0",{source:"\n.gojs-diagram[data-v-3757022f] {\r\n  position: relative;\r\n  width: 100%;\r\n  height: 100%;\n}\r\n",map:{version:3,sources:["D:\\work\\packages\\github\\gojs-vue\\src\\components\\Diagram.vue"],names:[],mappings:";AAwHA;EACA,kBAAA;EACA,WAAA;EACA,YAAA;AACA",file:"Diagram.vue",sourcesContent:["<template>\r\n  <div ref=\"divRef\" class=\"gojs-diagram\" :class=\"divClassName\"></div>\r\n</template>\r\n\r\n<script lang='ts'>\r\nimport { Component, Vue, Prop, Ref, Watch } from 'vue-property-decorator'\r\nimport * as go from 'gojs'\r\n\r\n@Component({})\r\nexport default class VueDiagram extends Vue {\r\n  @Ref('divRef') private divEle: HTMLDivElement\r\n\r\n  @Prop() divClassName?: string\r\n  @Prop() initDiagram!: () => go.Diagram\r\n  @Prop() nodeDataArray!: Array<go.ObjectData>\r\n  @Prop() linkDataArray?: Array<go.ObjectData>\r\n  @Prop() modelData?: go.ObjectData\r\n\r\n  private modelChangedListener: ((e: go.ChangedEvent) => void) | null = null\r\n\r\n  public getDiagram (): go.Diagram | null {\r\n    return this.divEle ? go.Diagram.fromDiv(this.divEle) : null\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  @Watch('divClassName')\r\n  updateDiagramClass () {\r\n    this.$nextTick(() => {\r\n      const diagram = this.getDiagram()\r\n      diagram.requestUpdate()\r\n    })\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  @Watch('nodeDataArray', { deep: true })\r\n  updateNodeDataArray () {\r\n    this.updateDiagram()\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  @Watch('linkDataArray', { deep: true })\r\n  updateLinkDataArray () {\r\n    this.updateDiagram()\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  mounted () {\r\n    const diagram = this.initDiagram()\r\n    diagram.div = this.divEle\r\n    diagram.delayInitialization(() => {\r\n      const model = diagram.model\r\n      model.commit((m: go.Model) => {\r\n        m.mergeNodeDataArray(m.cloneDeep(this.nodeDataArray))\r\n        if (!!this.linkDataArray && m instanceof go.GraphLinksModel) {\r\n          m.mergeLinkDataArray(m.cloneDeep(this.linkDataArray))\r\n        }\r\n        if (this.modelData) {\r\n          m.assignAllDataProperties(m.modelData, this.modelData)\r\n        }\r\n      }, null)\r\n    })\r\n\r\n    this.modelChangedListener = (e: go.ChangedEvent) => {\r\n      if (e.isTransactionFinished) {\r\n        const dataChanges = e.model.toIncrementalData(e)\r\n        if (dataChanges !== null) {\r\n          this.$emit('modelChange', dataChanges)\r\n        }\r\n      }\r\n    }\r\n    diagram.addModelChangedListener(this.modelChangedListener)\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  beforeDestroy () {\r\n    const diagram = this.getDiagram()\r\n    if (diagram) {\r\n      diagram.div = null\r\n      if (this.modelChangedListener !== null) {\r\n        diagram.removeModelChangedListener(this.modelChangedListener)\r\n        this.modelChangedListener = null\r\n      }\r\n    }\r\n  }\r\n\r\n  private updateDiagram () {\r\n    const diagram = this.getDiagram()\r\n    if (diagram) {\r\n      const model = diagram.model\r\n      if (this.modelChangedListener !== null) {\r\n        model.removeChangedListener(this.modelChangedListener)\r\n      }\r\n      model.startTransaction('update data')\r\n      model.mergeNodeDataArray(model.cloneDeep(this.nodeDataArray))\r\n      if (!!this.linkDataArray && model instanceof go.GraphLinksModel) {\r\n        model.mergeLinkDataArray(model.cloneDeep(this.linkDataArray))\r\n      }\r\n      if (this.modelData) {\r\n        model.assignAllDataProperties(model.modelData, this.modelData)\r\n      }\r\n      model.commitTransaction('update data')\r\n      if (this.modelChangedListener !== null) {\r\n        model.addChangedListener(this.modelChangedListener)\r\n      }\r\n    }\r\n  }\r\n}\r\n<\/script>\r\n\r\n<style scoped>\r\n.gojs-diagram {\r\n  position: relative;\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n</style>\r\n"]},media:void 0})}),d,"data-v-3757022f",!1,void 0,!1,(function(e){return(e,t)=>function(e,t){const a=r?t.media||"default":e,n=o[a]||(o[a]={ids:new Set,styles:[]});if(!n.ids.has(e)){n.ids.add(e);let a=t.source;if(t.map&&(a+="\n/*# sourceURL="+t.map.sources[0]+" */",a+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t.map))))+" */"),n.element||(n.element=document.createElement("style"),n.element.type="text/css",t.media&&n.element.setAttribute("media",t.media),void 0===i&&(i=document.head||document.getElementsByTagName("head")[0]),i.appendChild(n.element)),"styleSheet"in n.element)n.styles.push(a),n.element.styleSheet.cssText=n.styles.filter(Boolean).join("\n");else{const e=n.ids.size-1,t=document.createTextNode(a),r=n.element.childNodes;r[e]&&n.element.removeChild(r[e]),r.length?n.element.insertBefore(t,r[e]):n.element.appendChild(t)}}}(e,t)}),void 0,void 0);exports.VueDiagram=l;
